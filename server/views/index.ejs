<%- include('partials/header', { pageTitle: 'æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ' }) %>

<div class="latest" style="background:var(--card-bg); padding:1.5rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:2rem;">
  <h2>ğŸ“„ æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ</h2>
  <% if (latestHtmlFile) { %>
    <p><a href="/public/history/<%= latestHtmlFile %>" target="_blank">
      <%= formatReportName(latestHtmlFile) %> ã‚’è¡¨ç¤º
    </a></p>
  <% } else { %>
    <p>æœ€æ–°ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>
  <% } %>
</div>

<!-- å³æ™‚çµã‚Šè¾¼ã¿ç”¨æ¤œç´¢ -->
<input type="text" id="searchInput" placeholder="ãƒ‹ãƒ¥ãƒ¼ã‚¹æœ¬æ–‡ã§æ¤œç´¢" 
       style="width:100%; max-width:400px; padding:0.5rem; margin-bottom:0.5rem; border-radius:5px; border:1px solid #ccc;">

<h3 class="text-lg font-bold mt-6 mb-2">ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ã«è¦‹ã‚‹</h3>
<div class="flex flex-wrap gap-2">
  <% categories.forEach(cat => { %>
    <a href="/category/<%= encodeURIComponent(cat) %>"
       class="px-3 py-1 text-sm rounded-full border border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white transition duration-200">
       <%= cat %>
    </a>
  <% }) %>
</div>

<!-- ã‚‚ã£ã¨è¦‹ã‚‹ãƒªãƒ³ã‚¯ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿ï¼‰ -->
<a id="moreResultsLink" href="#" style="display:none; font-size:0.9rem;">â†’ æ¤œç´¢çµæœã‚’ã‚‚ã£ã¨è¦‹ã‚‹</a>

<h2>ğŸ“š éå»ã®ãƒ¬ãƒãƒ¼ãƒˆï¼ˆç›´è¿‘5ä»¶ï¼‰</h2>
<ul id="reportList">
  <% recentReports.forEach(report => { %>
    <li><a href="/public/history/<%= report.filename %>" target="_blank">
      <%= report.displayName %>
    </a></li>
  <% }) %>
</ul>

<p><a href="/history">â†’ å±¥æ­´ã‚’ã‚‚ã£ã¨è¦‹ã‚‹</a></p>

<script>
  const searchInput = document.getElementById('searchInput');
  const reportList = document.getElementById('reportList');
  const moreResultsLink = document.getElementById('moreResultsLink');

  searchInput.addEventListener('keyup', async function() {
    const query = this.value.trim();
    if (!query) {
      // æ¤œç´¢æ¬„ãŒç©º â†’ å…ƒã®ç›´è¿‘5ä»¶ã«æˆ»ã™
      moreResultsLink.style.display = 'none';
      reportList.innerHTML = `<% recentReports.forEach(report => { %>
        <li><a href="/public/history/<%= report.filename %>" target="_blank"><%= report.displayName %></a></li>
      <% }) %>`;
      return;
    }
    // å³æ™‚æ¤œç´¢ï¼ˆAJAXï¼‰
    const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
    const data = await res.json();
    reportList.innerHTML = data.slice(0, 5).map(r =>
      `<li><a href="/public/history/${r.filename}" target="_blank">${r.displayName}</a></li>`
    ).join('');

    // ã€Œã‚‚ã£ã¨è¦‹ã‚‹ã€ãƒªãƒ³ã‚¯è¨­å®š
    moreResultsLink.href = `/search-page?q=${encodeURIComponent(query)}`;
    moreResultsLink.style.display = 'inline-block';
  });
</script>

<%- include('partials/footer') %>
